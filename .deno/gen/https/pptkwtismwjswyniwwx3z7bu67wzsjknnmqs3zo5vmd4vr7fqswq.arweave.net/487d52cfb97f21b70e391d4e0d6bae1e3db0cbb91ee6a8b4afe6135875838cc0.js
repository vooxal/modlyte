import { Registry } from "./Registry.ts";
import {
  fetchTimeout,
  sortVersions,
  versionSubstitute,
} from "../utilities/utils.ts";
export class Github extends Registry {
  static domain = "raw.githubusercontent.com";
  static async sortedVersions(module, owner) {
    const res = await fetchTimeout(
      `https://api.github.com/repos/${owner}/${module}/releases`,
      5000,
    );
    const json = await res.json();
    if (!Array.isArray(json)) {
      throw new Error(`${Deno.inspect(json)} is not an array`);
    }
    const versions = json.map((release) => release.tag_name);
    const sorted = sortVersions(versions);
    if (sorted.length === 0) {
      const res = await fetch(
        `https://api.github.com/repos/${owner}/${module}/tags`,
      );
      const json = await res.json();
      const versions = json.map((tag) => tag.name);
      return sortVersions(versions);
    }
    return sorted;
  }
  static parseURL(url) {
    const tmpSplit = url.split("/");
    const name = tmpSplit[4];
    const version = tmpSplit[5];
    tmpSplit[5] = versionSubstitute;
    const parsedURL = tmpSplit.join("/");
    const owner = tmpSplit[3];
    const relativePath = tmpSplit.slice(6).join("/");
    return { name, version, parsedURL, owner, relativePath };
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR2l0aHViLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiR2l0aHViLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekMsT0FBTyxFQUNMLFlBQVksRUFDWixZQUFZLEVBQ1osaUJBQWlCLEdBQ2xCLE1BQU0sdUJBQXVCLENBQUM7QUFFL0IsTUFBTSxPQUFPLE1BQU8sU0FBUSxRQUFRO0lBQ2xDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsMkJBQTJCLENBQUM7SUFHNUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQ3pCLE1BQWMsRUFDZCxLQUFhO1FBRWIsTUFBTSxHQUFHLEdBQUcsTUFBTSxZQUFZLENBQzVCLGdDQUFnQyxLQUFLLElBQUksTUFBTSxXQUFXLEVBQzFELElBQUksQ0FDTCxDQUFDO1FBQ0YsTUFBTSxJQUFJLEdBQWMsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDeEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7U0FDMUQ7UUFDRCxNQUFNLFFBQVEsR0FBYSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBZ0IsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVFLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0QyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sR0FBRyxHQUFHLE1BQU0sS0FBSyxDQUNyQixnQ0FBZ0MsS0FBSyxJQUFJLE1BQU0sT0FBTyxDQUN2RCxDQUFDO1lBQ0YsTUFBTSxJQUFJLEdBQVUsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQWEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELE9BQU8sWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQy9CO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUlELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBVztRQUN6QixNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUIsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLGlCQUFpQixDQUFDO1FBQ2hDLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLENBQUM7SUFDM0QsQ0FBQyJ9
